<div class="calendar-container">

    <!-- Header -->
    <div class="calendar-header">
        <button (click)="previousMonth()">{{ previousMonthBtnLabel }}</button>
        <h2>{{ monthYear() }}</h2>
        <button (click)="nextMonth()">{{ nextMonthBtnLabel }}</button>
    </div>

    <!-- Grid -->
    <div class="calendar-grid">

        <div class="day-name" *ngFor="let day of dayLabels">
            {{ day }}
        </div>

        <!-- Loop Weeks -->
        <ng-container *ngFor="let week of weeks(); trackBy: trackByWeek">

            <!-- Week row -->
            <ng-container *ngFor="let day of week; trackBy: trackByDay">

                <div class="calendar-cell" [class.today]="isToday(day)" [class.weekend]="isWeekend(day)"
                    [class.other-month]="!isCurrentMonth(day)"
                    [class.selected]="selectedDate()?.toDateString() === day.toDateString()"
                    (dblclick)="onDoubleClick(day)" (touchstart)="onTouchStart(day)" (touchend)="onTouchEnd()">

                    <div class="date-number" [class.today-date]="isToday(day)" [class.weekend-date]="isWeekend(day)">
                        {{ day.getDate() }}
                    </div>

                    <!-- Event Badge -->
                    <!-- <div *ngIf="getEventCount(day) > 0" class="badge"
                        (click)="isCurrentMonth(day) && toggleEvents(day); $event.stopPropagation()">
                        {{ getEventCount(day) }}
                    </div> -->
                    <div *ngIf="getEventCount(day) > 0" class="event-count"
                        (click)="isCurrentMonth(day) && toggleEvents(day); $event.stopPropagation()">
                        <span>{{ badgeLabel }}</span>
                        <span class="badge">{{ getEventCount(day) }}</span>
                    </div>

                    <!-- Total Duration -->
                    <div class="total-duration" *ngIf="getEventCount(day) > 0 && getTotalDuration(day) !== ''">
                        <!-- (click)="isCurrentMonth(day) && toggleEvents(day); $event.stopPropagation()"> -->
                        {{ totalDurationLabel }} {{ getTotalDuration(day) }} hours
                    </div>

                </div>

            </ng-container>

            <!-- Expanded row -->
            <div class="expanded-row" *ngIf="isSelectedWeek(week) && getEventsForDate(selectedDate()!).length > 0"
                @expandCollapse>

                <div class="expanded-content">

                    <div *ngFor="let event of getEventsForDate(selectedDate()!); trackBy: trackByEvent"
                        class="expanded-event">

                        <span> {{ event.title }} </span>

                        <div class="actions">
                            <!-- <span (click)="editEvent(event)">Edit</span>
                            <span (click)="deleteEvent(event)">Delete</span> -->
                            <span *ngFor="let action of event?.actions" (click)="handleEventAction(action, event)"
                                [title]="action.tooltip ?? ''">
                                <i *ngIf="action.icon" class="{{ action.icon }}"></i>
                                <span *ngIf="(action.isBothIconAndLabel || !action.icon) && action.label">{{
                                    action.label }}</span>
                            </span>
                        </div>

                    </div>

                </div>

            </div>

        </ng-container>
    </div>

</div>